# CartographicProjection

CartographicProjection is a .NET solution that provides:

- A microservice (Service) for managing cartographic projections and running conversions between geodetic and cartographic coordinates.
- A Blazor Server web UI (WebApp) for interacting with the microservice.
- Shared model/code generators to keep DTOs and clients in sync with OpenAPI specifications.

Live (development) environment: https://dev.digiwells.no

Microservice Swagger: https://dev.digiwells.no/CartographicProjection/api/swagger

WebApp: https://dev.digiwells.no/CartographicProjection/webapp

## Solution Architecture

- ModelSharedIn
  - Generates DTOs used by the Model from external OpenAPI JSONs under `ModelSharedIn/json-schemas/`.
  - Output: `ModelSharedIn/MergedModel.cs` (namespace `NORCE.Drilling.CartographicProjection.ModelShared`).
- Model
  - Core domain and projection logic (DotSpatial), conversion methods, and data types.
  - References `ModelSharedIn` for geodetic datums and related types.
- Service
  - ASP.NET Core API that exposes CRUD and compute endpoints; serves Swagger UI and a merged OpenAPI document.
  - Persists data to SQLite at `home/CartographicProjection.db`.
- ModelSharedOut
  - Generates C# client + DTOs for consumers from OpenAPI JSONs under `ModelSharedOut/json-schemas/`.
  - Writes merged OpenAPI to `Service/wwwroot/json-schema/CartographicProjectionMergedModel.json`.
- WebApp
  - Blazor Server UI using MudBlazor + OSDC components; calls Service through the client generated by ModelSharedOut.
- Tests
  - ModelTest and ServiceTest for unit/integration testing.

See each project’s README for details.

## Install & Run (Local)

Prerequisites: .NET SDK 8.0, Docker (optional).

1) Generate inbound shared model (optional if already generated)

```bash
dotnet run --project ModelSharedIn/ModelSharedIn.csproj
```

2) Build core + service

```bash
dotnet build Model/Model.csproj
dotnet run  --project Service/Service.csproj
# Swagger: http://localhost:8080/CartographicProjection/api/swagger
```

3) Generate outbound client for consumers (optional for local dev)

```bash
dotnet run --project ModelSharedOut/ModelSharedOut.csproj
```

4) Run the WebApp

```bash
dotnet run --project WebApp/WebApp.csproj
# Web UI: http://localhost:8080/CartographicProjection/webapp
```

Environment configuration:

- Service: `GeodeticDatumHostURL` in `Service/appsettings.Development.json` (or env var).
- WebApp: `CartographicProjectionHostURL`, `GeodeticDatumHostURL`, `UnitConversionHostURL` in `WebApp/appsettings.Development.json` (or env vars).

## Docker

Build and run Service:

```bash
docker build -t norcedrillingcartographicprojectionservice -f Service/Dockerfile .
docker run -p 8080:8080 -e GeodeticDatumHostURL=https://dev.digiwells.no/ -v %CD%/home:/app/../home norcedrillingcartographicprojectionservice
```

Build and run WebApp:

```bash
docker build -t norcedrillingcartographicprojectionwebappclient -f WebApp/Dockerfile .
docker run -p 8080:8080 -e CartographicProjectionHostURL=https://dev.digiwells.no/ -e GeodeticDatumHostURL=https://dev.digiwells.no/ -e UnitConversionHostURL=https://dev.digiwells.no/ norcedrillingcartographicprojectionwebappclient
```

## Usage Examples

Base path (local): `http://localhost:8080/CartographicProjection/api`

List projection types:

```bash
curl http://localhost:8080/CartographicProjection/api/CartographicProjectionType
```

Create a projection (minimal skeleton):

```bash
curl -X POST http://localhost:8080/CartographicProjection/api/CartographicProjection \
  -H "Content-Type: application/json" \
  -d '{
        "MetaInfo": { "ID": "c0ffee00-0000-0000-0000-000000000001" },
        "Name": "UTM 32N",
        "ProjectionType": "UTM",
        "Zone": 32,
        "IsSouth": false
      }'
```

Create a conversion set and compute:

```bash
curl -X POST http://localhost:8080/CartographicProjection/api/CartographicConversionSet \
  -H "Content-Type: application/json" \
  -d '{
        "MetaInfo": { "ID": "c0ffee00-0000-0000-0000-000000000002" },
        "Name": "Demo conversion",
        "CartographicProjectionID": "c0ffee00-0000-0000-0000-000000000001",
        "CartographicCoordinateList": [
          { "Northing": 6740000.0, "Easting": 300000.0, "VerticalDepth": 0.0 }
        ]
      }'
```

Consult Swagger for the full contract.

## Dependencies (Highlights)

- DotSpatial.Projections.NetStandard — projection math (Model)
- OSDC.DotnetLibraries.* — shared utilities and domain types (Model/WebApp)
- NSwag + Microsoft.OpenApi — OpenAPI parsing and C# generation (ModelSharedIn/Out)
- Swashbuckle.AspNetCore — Swagger generation/hosting (Service)
- SQLite (Microsoft.Data.Sqlite) — persistence (Service)
- MudBlazor + OSDC UnitConversion Razor components — UI components (WebApp)

## Security & Data

- Data persist as clear text in a single SQLite DB (`home/CartographicProjection.db`).
- No authentication/authorization is implemented by default.
- Docker images are available under the `digiwells` org on Docker Hub: https://hub.docker.com/?namespace=digiwells

## Links

- Microservice Swagger (dev): https://dev.digiwells.no/CartographicProjection/api/swagger
- WebApp (dev): https://dev.digiwells.no/CartographicProjection/webapp

## Funding

The current work has been funded by the [Research Council of Norway](https://www.forskningsradet.no/) and [Industry partners](https://www.digiwells.no/about/board/) in the framework of the centre for research-based innovation [SFI Digiwells (2020–2028)](https://www.digiwells.no/) focused on Digitalization, Drilling Engineering and GeoSteering.

## Contributors

**Eric Cayeux**, *NORCE Energy Modelling and Automation*

**Gilles Pelfrene**, *NORCE Energy Modelling and Automation*

**Andrew Holsaeter**, *NORCE Energy Modelling and Automation*

**Lucas Volpi**, *NORCE Energy Modelling and Automation*
